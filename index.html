<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>首页</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
<header class="topbar">
    <div class="brand">三农服务平台</div>
    <nav class="nav">
        <a href="loans.html" data-identity="1">融资服务</a>
        <a href="appointment.html" data-identity="1">预约服务</a>
        <a href="products.html" data-identity="1">农产品服务</a>
    </nav>
    <div class="user">
        <span id="user-id-display" class="user-id"></span>
        <a href="profile.html" class="btn btn-secondary" style="margin-right:8px;">个人中心</a>
        <button id="btn-logout" class="btn">退出登录</button>
    </div>
</header>

<main class="container">
    <section id="news" class="card" data-identity="1">
        <div class="card-header">
            <h2>新闻轮播</h2>
            <button id="news-refresh" class="btn btn-secondary">刷新</button>
        </div>
        <div class="carousel" id="news-carousel">
            <div class="slides" id="news-slides"></div>
            <div class="dots" id="news-dots"></div>
        </div>
        <div class="msg" id="msg-news"></div>
    </section>

    <section id="products" class="card" data-identity="1">
        <div class="card-header">
            <h2>金融产品</h2>
            <button id="products-refresh" class="btn btn-secondary">换一批</button>
        </div>
        <div class="grid" id="products-grid"></div>
        <div class="msg" id="msg-products"></div>
    </section>

    <section id="experts" class="card" data-identity="1">
        <div class="card-header">
            <h2>专家列表</h2>
        </div>
        <div class="list" id="experts-list"></div>
        <div class="msg" id="msg-experts"></div>
        <div class="divider"></div>
        <div class="form-inline" style="flex-wrap:wrap;gap:8px;">
            <input type="text" id="expert-search-keyword" placeholder="输入专家姓名">
            <button id="btn-search-experts" class="btn btn-secondary">按姓名搜索</button>
        </div>
        <div class="list" id="experts-search-list"></div>
        <div class="msg" id="msg-experts-search"></div>
        <div class="divider"></div>
        <form id="form-expert-detail" class="form">
            <div class="row">
                <label for="expert-detail-name">专家姓名</label>
                <input type="text" id="expert-detail-name" placeholder="请输入专家姓名" required>
            </div>
            <button type="submit" class="btn btn-secondary">查看专家详情</button>
            <div class="msg" id="msg-expert-detail"></div>
        </form>
        <div class="detail-box" id="expert-detail-box"></div>
    </section>

    <section id="knowledge" class="card" data-identity="1">
        <div class="card-header">
            <h2>农业知识库</h2>
            <button id="btn-load-knowledge" class="btn btn-secondary">刷新列表</button>
        </div>
        <div class="form-inline" style="flex-wrap:wrap;">
            <input type="number" id="knowledge-page" placeholder="页码" min="1" value="1">
            <input type="number" id="knowledge-size" placeholder="每页条数" min="1" value="6">
        </div>
        <div class="list" id="knowledge-list"></div>
        <div class="msg" id="msg-knowledge"></div>
        <div class="divider"></div>
        <div class="form-inline" style="flex-wrap:wrap;">
            <input type="text" id="knowledge-keyword" placeholder="关键词（标题）">
            <input type="number" id="knowledge-search-page" placeholder="页码" min="1" value="1">
            <input type="number" id="knowledge-search-size" placeholder="每页条数" min="1" value="6">
            <button id="btn-search-knowledge" class="btn btn-secondary">搜索</button>
        </div>
        <div class="list" id="knowledge-search-list"></div>
        <div class="msg" id="msg-knowledge-search"></div>
    </section>

    <section id="appointment-preview" class="card" data-identity="1">
        <div class="card-header">
            <h2>专家预约服务</h2>
            <a href="appointment.html" class="btn btn-secondary">前往预约页面</a>
        </div>
        <p>
            一站式专家预约平台，支持农户在线预约、管理咨询记录，专家可在线审批、查看日程。点击“前往预约页面”即可进入完整功能。
        </p>
    </section>

    <!-- 专家审批预约（专家端，identity=3） -->
    <section id="expert-appointment-review" class="card" data-identity="3">
        <div class="card-header">
            <h2>专家审批预约</h2>
            <button id="btn-load-pending-appointments" class="btn btn-secondary">刷新待审批列表</button>
        </div>
        <div class="list" id="pending-appointments-list"></div>
        <div class="msg" id="msg-pending-appointments"></div>
        <div class="divider"></div>
        <form id="form-review-appointment" class="form">
            <h3>审批预约</h3>
            <div class="row">
                <label for="review-appointment-id">预约ID</label>
                <input type="number" id="review-appointment-id" placeholder="请输入预约ID" required>
            </div>
            <div class="row">
                <label for="review-action">审批操作</label>
                <select id="review-action" required>
                    <option value="">请选择</option>
                    <option value="同意">同意</option>
                    <option value="拒绝">拒绝</option>
                </select>
            </div>
            <div class="row">
                <label for="review-comment">审批备注（可选）</label>
                <textarea id="review-comment" rows="3" placeholder="可填写审批同意或拒绝的原因"></textarea>
            </div>
            <button type="submit" class="btn">提交审批</button>
            <div class="msg" id="msg-review-appointment"></div>
        </form>
    </section>

    <!-- 专家预约日程（专家端，identity=3） -->
    <section id="expert-appointment-schedule" class="card" data-identity="3">
        <div class="card-header">
            <h2>我的预约日程</h2>
            <button id="btn-load-schedule" class="btn btn-secondary">刷新日程</button>
        </div>
        <div class="list" id="schedule-list"></div>
        <div class="msg" id="msg-schedule"></div>
    </section>

    <!-- 更新预约状态（专家端，identity=3） -->
    <section id="expert-update-status" class="card" data-identity="3">
        <div class="card-header">
            <h2>更新预约状态</h2>
        </div>
        <form id="form-update-status" class="form">
            <h3>咨询后更新状态</h3>
            <div class="row">
                <label for="update-appointment-id">预约ID</label>
                <input type="number" id="update-appointment-id" placeholder="请输入预约ID" required>
            </div>
            <div class="row">
                <label for="update-status">更新状态</label>
                <select id="update-status" required>
                    <option value="">请选择</option>
                    <option value="completed">已完成</option>
                    <option value="no_show">农户未到场</option>
                </select>
            </div>
            <button type="submit" class="btn">提交更新</button>
            <div class="msg" id="msg-update-status"></div>
        </form>
    </section>

    <!-- 融资服务模块 -->
    <section id="loan-services" class="card" data-identity="1">
        <div class="card-header">
            <h2>贷款办理 & 还款管理</h2>
            <a href="loans.html" class="btn btn-secondary">前往贷款中心</a>
        </div>
        <p>
            提供贷款申请、我的申请进度查询以及还款计划、还款记录等全流程服务。点击“前往贷款中心”即可办理相关业务。
        </p>
    </section>

    <section id="loan-product-manage" class="card" data-identity="4">
        <div class="card-header">
            <h2>贷款产品管理</h2>
        </div>
        <div class="grid grid-2">
            <form id="form-create-loan-product" class="form">
                <h3>新增产品</h3>
                <div class="row"><label for="product-name">名称</label><input id="product-name" required></div>
                <div class="row"><label for="product-category">类型</label><input id="product-category" required></div>
                <div class="row"><label for="product-max">最高额度</label><input type="number" id="product-max" required></div>
                <div class="row"><label for="product-min">最低额度</label><input type="number" id="product-min" required></div>
                <div class="row"><label for="product-rate">利率(%)</label><input type="number" step="0.01" id="product-rate" required></div>
                <div class="row"><label for="product-term">期限(月)</label><input type="number" id="product-term" required></div>
                <div class="row"><label for="product-desc">简介</label><textarea id="product-desc" rows="2"></textarea></div>
                <button type="submit" class="btn">创建产品</button>
                <div class="msg" id="msg-create-product"></div>
            </form>
            <div class="form-stack">
                <form id="form-delete-product" class="form">
                    <h3>删除产品</h3>
                    <div class="row"><label for="delete-product-id">产品ID</label><input type="number" id="delete-product-id" required></div>
                    <button type="submit" class="btn btn-danger">删除</button>
                    <div class="msg" id="msg-delete-product"></div>
                </form>
                <form id="form-product-detail" class="form">
                    <h3>产品详情</h3>
                    <div class="row"><label for="detail-product-id">产品ID</label><input type="number" id="detail-product-id" required></div>
                    <button type="submit" class="btn btn-secondary">查询详情</button>
                    <div class="msg" id="msg-product-detail"></div>
                </form>
                <div class="detail-box" id="loan-product-detail"></div>
            </div>
        </div>
    </section>

    <section id="loan-approvals" class="card" data-identity="4">
        <div class="card-header">
            <h2>审批中心</h2>
            <button id="btn-load-pending" class="btn btn-secondary">加载待审批</button>
        </div>
        <div class="list" id="pending-list"></div>
        <div class="divider"></div>
        <form id="form-approve" autocomplete="off" class="form">
            <div class="row">
                <label for="approve-applicationId">申请ID</label>
                <input type="number" id="approve-applicationId" required>
            </div>
            <div class="row">
                <label for="approve-approverId">审批人ID</label>
                <input type="number" id="approve-approverId" required>
            </div>
            <div class="row">
                <label for="approve-decision">决定</label>
                <select id="approve-decision" required>
                    <option value="1">通过</option>
                    <option value="0">拒绝</option>
                </select>
            </div>
            <div class="row">
                <label for="approve-remark">备注</label>
                <input type="text" id="approve-remark">
            </div>
            <button type="submit" class="btn">提交审批</button>
            <div class="msg" id="msg-approve"></div>
        </form>
        <div class="divider"></div>
        <div class="form-inline">
            <input type="number" id="history-applicationId" placeholder="申请ID">
            <button id="btn-load-approval-history" class="btn btn-secondary">查看审批历史</button>
        </div>
        <div class="list" id="approval-history-list"></div>
        <div class="msg" id="msg-approval-history"></div>
    </section>

    <section id="loan-status" class="card" data-identity="1">
        <div class="card-header">
            <h2>贷款状态字典</h2>
            <button id="btn-load-status" class="btn btn-secondary">刷新</button>
        </div>
        <div class="list" id="loan-status-list"></div>
        <div class="msg" id="msg-loan-status"></div>
        <div class="divider"></div>
        <div class="grid grid-2">
            <form id="form-create-loan-status" class="form">
                <h3>新增状态</h3>
                <div class="row"><label for="status-code">状态代码</label><input type="number" id="status-code" required></div>
                <div class="row"><label for="status-name">状态名称</label><input type="text" id="status-name" required></div>
                <div class="row"><label for="status-desc">描述</label><textarea id="status-desc" rows="2"></textarea></div>
                <button type="submit" class="btn">新增状态</button>
                <div class="msg" id="msg-create-loan-status"></div>
            </form>
            <div class="form-stack">
                <form id="form-update-loan-status" class="form">
                    <h3>修改状态</h3>
                    <div class="row"><label for="update-status-id">状态ID</label><input type="number" id="update-status-id" required></div>
                    <div class="row"><label for="update-status-name">状态名称</label><input type="text" id="update-status-name" required></div>
                    <div class="row"><label for="update-status-desc">描述</label><textarea id="update-status-desc" rows="2"></textarea></div>
                    <button type="submit" class="btn">修改状态</button>
                    <div class="msg" id="msg-update-loan-status"></div>
                </form>
                <form id="form-delete-loan-status" class="form">
                    <h3>删除状态</h3>
                    <div class="row"><label for="delete-status-id">状态ID</label><input type="number" id="delete-status-id" required></div>
                    <button type="submit" class="btn btn-danger">删除状态</button>
                    <div class="msg" id="msg-delete-loan-status"></div>
                </form>
            </div>
        </div>
    </section>

    <!-- 商品模块 -->
    <section id="agricultural-products" class="card" data-identity="2">
        <div class="card-header">
            <h2>农产品商城</h2>
            <div class="card-actions">
                <button id="btn-refresh-products" class="btn btn-secondary">刷新商品</button>
            </div>
        </div>
        <div class="product-grid" id="product-catalog-list"></div>
        <div class="msg" id="msg-product-catalog"></div>
    </section>

    <div id="product-modal" class="modal-backdrop hidden" role="dialog" aria-modal="true">
        <div class="modal modal-large">
            <button class="modal-close" id="btn-close-product-modal" aria-label="关闭">×</button>
            <div class="product-modal-body">
                <div class="detail-box">
                    <div class="msg" id="modal-product-msg">加载商品详情中...</div>
                    <div id="modal-product-info"></div>
                </div>
                <div class="comment-block">
                    <h3>评论区</h3>
                    <div class="msg" id="modal-comment-msg"></div>
                    <div class="comment-list" id="modal-comment-list"></div>
                </div>
            </div>
            <div class="product-modal-actions">
                <div class="modal-selected-name" id="modal-selected-name"></div>
                <div class="modal-action-buttons">
                    <button type="button" class="btn btn-secondary" id="btn-modal-add-cart">加入购物车</button>
                    <button type="button" class="btn" id="btn-modal-purchase">直接购买</button>
                </div>
            </div>
        </div>
    </div>

    <div id="purchase-modal" class="modal-backdrop hidden" role="dialog" aria-modal="true">
        <div class="modal">
            <h3 id="purchase-modal-title">填写信息</h3>
            <p class="subtle" id="purchase-modal-product-name"></p>
            <form id="form-purchase-modal">
                <div class="row" id="purchase-modal-amount-row">
                    <label for="purchase-modal-amount">购买数量</label>
                    <input type="number" id="purchase-modal-amount" min="1" value="1" required>
                </div>
                <div class="row" id="purchase-modal-address-group">
                    <label for="purchase-modal-address">收货地址</label>
                    <div class="address-field">
                        <div class="address-select-stack">
                            <select id="purchase-modal-address-select">
                                <option value="">选择保存的地址</option>
                            </select>
                            <button type="button" class="btn btn-secondary" id="btn-refresh-address">刷新</button>
                        </div>
                        <input type="text" id="purchase-modal-address" placeholder="请选择或输入详细地址">
                    </div>
                </div>
                <div class="msg" id="msg-purchase-modal"></div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="btn-purchase-cancel">取消</button>
                    <button type="submit" class="btn">确认提交</button>
                </div>
            </form>
        </div>
    </div>

    <!-- 评论模块 -->
    <section id="product-comments" class="card" data-identity="2">
        <div class="card-header">
            <h2>商品评论</h2>
        </div>
        <div class="two-col">
            <form id="form-add-comment" class="form">
                <h3>发布评论</h3>
                <div class="row"><label for="comment-productId">商品ID</label><input type="number" id="comment-productId" required></div>
                <div class="row"><label for="comment-content">评论内容</label><textarea id="comment-content" rows="3" required></textarea></div>
                <div class="row"><label for="comment-rootId">父评论ID（可选，回复时填写）</label><input type="number" id="comment-rootId"></div>
                <button type="submit" class="btn">发布评论</button>
                <div class="msg" id="msg-comment"></div>
            </form>
            <form id="form-reply-comment" class="form">
                <h3>回复评论</h3>
                <div class="row"><label for="reply-productId">商品ID</label><input type="number" id="reply-productId" required></div>
                <div class="row"><label for="reply-content">回复内容</label><textarea id="reply-content" rows="3" required></textarea></div>
                <div class="row"><label for="reply-rootId">父评论ID</label><input type="number" id="reply-rootId" required></div>
                <div class="row"><label for="reply-toId">回复的评论ID</label><input type="number" id="reply-toId" required></div>
                <button type="submit" class="btn">发布回复</button>
                <div class="msg" id="msg-reply"></div>
            </form>
        </div>
        <div class="divider"></div>
        <div class="form-inline">
            <input type="number" id="like-comment-id" placeholder="评论ID">
            <button id="btn-like-comment" class="btn btn-secondary">点赞</button>
            <span id="like-count-display"></span>
        </div>
        <div class="msg" id="msg-like"></div>
        <div class="divider"></div>
        <form id="form-delete-comment" class="form">
            <h3>删除评论</h3>
            <div class="row"><label for="delete-comment-id">评论ID</label><input type="number" id="delete-comment-id" required></div>
            <button type="submit" class="btn btn-danger">删除评论</button>
            <div class="msg" id="msg-delete-comment"></div>
        </form>
    </section>

    <!-- 购物车展示 -->
    <section id="buyer-cart" class="card" data-identity="2">
        <div class="card-header">
            <h2>我的购物车</h2>
            <div class="card-actions">
                <button id="btn-refresh-cart" class="btn btn-secondary">刷新购物车</button>
            </div>
        </div>
        <div class="list" id="cart-display-list"></div>
        <div class="msg" id="msg-cart-display"></div>
    </section>

    <!-- 购买记录展示 -->
    <section id="buyer-orders" class="card" data-identity="2">
        <div class="card-header">
            <h2>我的购买记录</h2>
            <div class="card-actions">
                <button id="btn-refresh-orders" class="btn btn-secondary">刷新购买记录</button>
            </div>
        </div>
        <div class="list" id="orders-display-list"></div>
        <div class="msg" id="msg-orders-display"></div>
    </section>
</main>

<script src="index.js"></script>
<script src="appointment.js"></script>
</body>
</html>

