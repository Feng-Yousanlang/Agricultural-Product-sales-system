<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>三农服务平台 - 智慧农业金融一体化解决方案</title>
    <link rel="stylesheet" href="index.css">
    <!-- 引入 Font Awesome 图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
<header class="topbar">
    <div class="brand">
        <i class="fa-solid fa-seedling"></i>
        <span>三农服务平台</span>
    </div>
    <nav class="nav">
        <a href="index.html" class="current">首页</a>
        <a href="loans.html" data-identity="1">融资服务</a>
        <a href="appointment.html" data-identity="1">专家预约</a>
        <a href="buy.html" data-identity="all">农产品商城</a>
        <a href="knowledge.html" data-identity="all">知识库</a>
        <a href="products.html" data-identity="1">农产品管理</a>
        <a href="need.html" data-identity="all">求购平台</a>
        <a href="price.html" data-identity="all">物价预测</a>
    </nav>
    <div class="user">
        <span id="user-id-display" class="user-id"></span>
        <a href="profile.html" class="btn btn-secondary">
            <i class="fa-regular fa-user" style="margin-right: 6px;"></i>个人中心
        </a>
        <button id="btn-logout" class="btn-secondary" style="border:none; color: rgba(255,255,255,0.7);">退出</button>
    </div>
</header>

<main class="container">
    <!-- 核心功能入口 (Feature Cards) -->
    <section class="features-grid" data-identity="1">
        <a href="loans.html" class="feature-card">
            <div class="feature-icon"><i class="fa-solid fa-sack-dollar"></i></div>
            <div class="feature-content">
                <h3>贷款融资</h3>
                <p>普惠金融低息贷款，快速审批，助力农业生产资金周转。</p>
            </div>
        </a>
        <a href="appointment.html" class="feature-card">
            <div class="feature-icon"><i class="fa-solid fa-user-doctor"></i></div>
            <div class="feature-content">
                <h3>专家预约</h3>
                <p>百名农业专家在线答疑，预约上门指导，解决技术难题。</p>
            </div>
        </a>
        <a href="products.html" class="feature-card">
            <div class="feature-icon"><i class="fa-solid fa-basket-shopping"></i></div>
            <div class="feature-content">
                <h3>农产商城</h3>
                <p>优质农产品直供直销，拓宽销售渠道，增加农民收入。</p>
            </div>
        </a>
    </section>

    <!-- 新闻轮播区 -->
    <section id="news" class="card" data-identity="1">
        <div class="carousel" id="news-carousel">
            <div class="slides" id="news-slides"></div>
            <div class="dots" id="news-dots"></div>
            <button class="carousel-arrow prev" id="news-prev" aria-label="上一条">‹</button>
            <button class="carousel-arrow next" id="news-next" aria-label="下一条">›</button>
            <div class="news-title"><a id="news-title-link" target="_blank" rel="noopener"></a></div>
        </div>
        <div class="msg" id="msg-news"></div>
    </section>

    <!-- 右侧侧边栏：知识库与快捷入口 -->
    <div class="sidebar-col" data-identity="1">
        <section id="knowledge" class="card" style="flex: 1;">
            <div class="card-header">
                <h2>农业知识库</h2>
                <a href="knowledge.html" class="btn btn-secondary" style="color: #666; border-color: #ddd; font-size: 12px; padding: 4px 10px;">更多</a>
            </div>
            <div class="list" id="knowledge-list">
                <!-- 列表由JS填充 -->
            </div>
            <div class="msg" id="msg-knowledge"></div>
        </section>

    </div>

    <!-- 推荐金融产品 -->
    <section id="products" class="card" data-identity="1">
        <div class="card-header">
            <h2>热门金融产品</h2>
            <div class="form-inline" style="gap:8px;">
                <button id="products-prev" class="btn btn-secondary" style="color:#666; border-color:#ddd;"><i class="fa-solid fa-chevron-left"></i></button>
                <button id="products-next" class="btn btn-secondary" style="color:#666; border-color:#ddd;"><i class="fa-solid fa-chevron-right"></i></button>
            </div>
        </div>
        <div class="product-grid" id="products-grid"></div>
        <div class="msg" id="msg-products"></div>
    </section>

    <!-- 专家端/银行端专属模块 (保持原ID以便JS兼容) -->
    
    <!-- 专家审批预约 -->
    <section id="expert-appointment-review" class="card" data-identity="3">
        <div class="card-header">
            <h2>专家审批预约</h2>
            <button id="btn-load-pending-appointments" class="btn btn-secondary" style="color:#666; border-color:#ddd;">刷新</button>
        </div>
        <div class="list" id="pending-appointments-list"></div>
        <div class="msg" id="msg-pending-appointments"></div>
    </section>

    <!-- 专家日程 -->
    <section id="expert-appointment-schedule" class="card" data-identity="3">
        <div class="card-header">
            <h2>我的预约日程</h2>
            <button id="btn-load-schedule" class="btn btn-secondary" style="color:#666; border-color:#ddd;">刷新</button>
        </div>
        <div class="list" id="schedule-list"></div>
        <div class="msg" id="msg-schedule"></div>
    </section>

    <!-- 银行产品管理 -->
    <section id="loan-product-manage" class="card" data-identity="4">
        <div class="card-header">
            <div>
                <h2>贷款产品管理</h2>
            </div>
            <div class="loan-product-toolbar" style="display:flex; gap:8px;">
                <input type="text" id="loan-product-search-q" placeholder="搜索产品" style="padding: 6px 12px; border: 1px solid #ddd; border-radius: 2px;">
                <button id="loan-product-search-btn" class="btn">搜索</button>
                <button id="loan-products-refresh" class="btn btn-secondary" style="color:#666; border-color:#ddd;">刷新</button>
            </div>
        </div>
        
        <div class="loan-product-create" style="background:#f9f9f9; padding:20px; border-radius:2px; margin-bottom:24px;">
            <h3 style="margin-top:0; margin-bottom:16px; font-size:16px;">新建贷款产品</h3>
            <form id="form-loan-product-create" class="form" style="display:grid; grid-template-columns: repeat(3, 1fr); gap:16px;">
                <div class="row">
                    <label style="display:block; margin-bottom:6px; font-size:13px;">产品名称 <span style="color:red">*</span></label>
                    <input type="text" id="loan-product-name" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:2px;" required>
                </div>
                <div class="row">
                    <label style="display:block; margin-bottom:6px; font-size:13px;">产品标签</label>
                    <input type="text" id="loan-product-category" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:2px;">
                </div>
                <div class="row">
                    <label style="display:block; margin-bottom:6px; font-size:13px;">年化利率(%)</label>
                    <input type="number" id="loan-product-rate" step="0.01" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:2px;">
                </div>
                <div class="row">
                    <label style="display:block; margin-bottom:6px; font-size:13px;">最低额度(元)</label>
                    <input type="number" id="loan-product-min" step="1000" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:2px;">
                </div>
                <div class="row">
                    <label style="display:block; margin-bottom:6px; font-size:13px;">最高额度(元)</label>
                    <input type="number" id="loan-product-max" step="1000" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:2px;">
                </div>
                <div class="row">
                    <label style="display:block; margin-bottom:6px; font-size:13px;">最长期限(月)</label>
                    <input type="number" id="loan-product-term" step="1" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:2px;">
                </div>
                <div class="row" style="grid-column: span 3;">
                    <label style="display:block; margin-bottom:6px; font-size:13px;">产品描述</label>
                    <textarea id="loan-product-desc" rows="2" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:2px;"></textarea>
                </div>
                <div class="row" style="grid-column: span 3; text-align:right;">
                    <button type="submit" class="btn">提交新产品</button>
                </div>
            </form>
            <div class="msg" id="msg-loan-product-create"></div>
        </div>

        <div class="loan-products-list-header">
            <h3 style="font-size:16px; margin-bottom:16px;">现有产品列表</h3>
        </div>
        <div class="loan-products-grid" id="loan-products-grid" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap:16px;"></div>
        <div class="msg" id="msg-loan-products"></div>
    </section>

    <!-- 银行审批中心 -->
    <section id="loan-approvals" class="card" data-identity="4">
        <div class="card-header">
            <h2>审批中心</h2>
            <button id="btn-load-pending" class="btn btn-secondary" style="color:#666; border-color:#ddd;">刷新</button>
        </div>
        <div class="list" id="pending-list"></div>
        <div class="msg" id="msg-approve"></div>
        
        <div class="divider" style="height:1px; background:#eee; margin:24px 0;"></div>
        
        <!-- <div class="card-header">
            <h2>我的审批历史</h2>
            <button id="btn-load-approval-history" class="btn btn-secondary" style="color:#666; border-color:#ddd;">刷新</button>
        </div>
        <div class="list" id="approval-history-list"></div>
        <div class="msg" id="msg-approval-history"></div> -->
    </section>
</main>

<!-- 模态框保持不变，样式会自动继承 -->
<div id="loan-product-modal" class="modal-backdrop hidden">
    <div class="modal card" style="max-width:350px; max-height:200px; margin: 150px auto;">
        <div class="card-header">
            <h3 id="loan-product-modal-title">产品操作</h3>
            <span class="modal-close" id="loan-product-modal-close" style="cursor:pointer; font-size:20px;">&times;</span>
        </div>
        <div id="loan-product-modal-body" style="padding:16px 0;"></div>
        <div class="modal-actions" style="display:flex; justify-content:center; gap:12px; margin-top:16px;">
            <button type="button" class="btn btn-danger" id="btn-delete-loan-product" style="background:#ff4d4f; border:none;">删除该产品</button>
            <button type="button" class="btn btn-secondary" id="loan-product-modal-cancel" style="color:#666; border-color:#ddd;">关闭</button>
        </div>
        <div class="msg" id="msg-loan-product-modal"></div>
    </div>
</div>

<!-- 商品详情模态框 -->
<div id="product-modal" class="modal-backdrop hidden">
    <div class="modal card" style="max-width:800px; margin: 60px auto;">
        <div class="card-header">
            <h3>商品详情</h3>
            <button class="modal-close" id="btn-close-product-modal" style="background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
        </div>
        <div class="product-modal-body" style="display:grid; grid-template-columns: 1fr 1fr; gap:24px;">
            <div class="detail-box">
                <div class="msg" id="modal-product-msg">加载中...</div>
                <div id="modal-product-info"></div>
            </div>
            <div class="comment-block">
                <h4 style="margin-top:0;">评论区</h4>
                <div class="comment-input-box">
                    <textarea id="comment-content-input" rows="3" placeholder="分享你的看法..." style="width:100%; padding:8px; border:1px solid #ddd; border-radius:2px;" disabled></textarea>
                    <div class="comment-input-actions" style="margin-top:8px; display:flex; justify-content:space-between; align-items:center;">
                        <span class="reply-tip hidden" id="replying-to" style="font-size:12px; color:#666;">
                            回复 <strong id="reply-target-name"></strong>
                            <button type="button" id="btn-cancel-reply" style="border:none; background:none; color:blue; cursor:pointer;">取消</button>
                        </span>
                        <button type="button" class="btn" id="btn-submit-comment" disabled>发布</button>
                    </div>
                    <div class="msg" id="msg-comment"></div>
                </div>
                <div class="comment-list" id="modal-comment-list" style="margin-top:16px; max-height:300px; overflow-y:auto;"></div>
            </div>
        </div>
        <div class="product-modal-actions" style="margin-top:24px; padding-top:16px; border-top:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
            <div class="modal-selected-name" id="modal-selected-name" style="font-weight:600;"></div>
            <div class="modal-action-buttons" style="display:flex; gap:12px;">
                <button type="button" class="btn btn-secondary" id="btn-modal-add-cart" style="color:#666; border-color:#ddd;">加入购物车</button>
                <button type="button" class="btn" id="btn-modal-purchase">直接购买</button>
            </div>
        </div>
    </div>
</div>

<!-- 购买确认模态框 -->
<div id="purchase-modal" class="modal-backdrop hidden">
    <div class="modal card" style="max-width:500px; margin: 100px auto;">
        <h3 id="purchase-modal-title">确认购买信息</h3>
        <p class="subtle" id="purchase-modal-product-name" style="color:#666; margin-bottom:16px;"></p>
        <form id="form-purchase-modal">
            <div class="row" style="margin-bottom:16px;">
                <label for="purchase-modal-amount" style="display:block; margin-bottom:6px;">购买数量</label>
                <input type="number" id="purchase-modal-amount" min="1" value="1" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:2px;" required>
            </div>
            <div class="row" style="margin-bottom:16px;">
                <label for="purchase-modal-address" style="display:block; margin-bottom:6px;">收货地址</label>
                <div class="address-field">
                    <select id="purchase-modal-address-select" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:2px; margin-bottom:8px;">
                        <option value="">选择保存的地址</option>
                    </select>
                    <input type="text" id="purchase-modal-address" placeholder="或输入新地址" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:2px;">
                </div>
            </div>
            <div class="msg" id="msg-purchase-modal"></div>
            <div class="modal-actions" style="display:flex; justify-content:flex-end; gap:12px;">
                <button type="button" class="btn btn-secondary" id="btn-purchase-cancel" style="color:#666; border-color:#ddd;">取消</button>
                <button type="submit" class="btn">确认提交</button>
            </div>
        </form>
    </div>
</div>

<script src="appointment.js"></script>
    <script src="index.js"></script>
</body>
</html>
